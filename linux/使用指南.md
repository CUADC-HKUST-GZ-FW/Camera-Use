# æµ·åº·å¨è§†ç›¸æœºæ§åˆ¶ç¨‹åº - ä½¿ç”¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ£€æŸ¥è®¾å¤‡è¿æ¥
```bash
# æ£€æŸ¥USBè®¾å¤‡
lsusb | grep -i hikvision

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
# Bus 001 Device 005: ID 2bdf:0002 Hikvision camera
```

### 2. è¿è¡Œå¿«é€Ÿæµ‹è¯•
```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x quick_test.sh

# è¿è¡Œå¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èä½¿ç”¨sudoï¼‰
sudo ./quick_test.sh
```

### 3. å¦‚æœæµ‹è¯•é€šè¿‡ï¼Œè¿è¡Œå®Œæ•´ç¨‹åº
```bash
sudo python3 hikvision_camera_controller_linux.py --calibration ../calibration/20250910_232046/calibration_result.json
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. CALLORDERé”™è¯¯ (0x80000004)
**ç—‡çŠ¶**: ç¨‹åºæŠ¥å‘Š"å‡½æ•°è°ƒç”¨é¡ºåºé”™è¯¯"

**è§£å†³æ–¹æ¡ˆï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰**:
1. **é‡æ–°æ’æ‹”USBè®¾å¤‡**
   ```bash
   # æ‹”å‡ºUSBçº¿ï¼Œç­‰å¾…5ç§’ï¼Œé‡æ–°æ’å…¥
   # ç„¶åé‡æ–°è¿è¡Œç¨‹åº
   ```

2. **ç³»ç»Ÿé‡å¯**ï¼ˆæœ€æœ‰æ•ˆï¼‰
   ```bash
   sudo reboot
   ```

3. **æ£€æŸ¥è¿›ç¨‹å†²çª**
   ```bash
   # ç»ˆæ­¢å¯èƒ½å†²çªçš„è¿›ç¨‹
   sudo pkill -f camera
   sudo pkill -f mvs
   ```

#### 2. æƒé™é—®é¢˜
**ç—‡çŠ¶**: "æƒé™è¢«æ‹’ç»"æˆ–æ— æ³•è®¿é—®è®¾å¤‡

**è§£å†³æ–¹æ¡ˆ**:
```bash
# è¿è¡Œæƒé™ä¿®å¤è„šæœ¬
chmod +x fix_permissions.sh
sudo ./fix_permissions.sh

# æˆ–è€…æ‰‹åŠ¨è®¾ç½®æƒé™
sudo chmod 666 /dev/bus/usb/*/*
```

#### 3. SDKå¯¼å…¥å¤±è´¥
**ç—‡çŠ¶**: "No module named MvCameraControl_class"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
source ~/.bashrc

# æˆ–æ‰‹åŠ¨è®¾ç½®
export MVCAM_COMMON_RUNENV=/opt/MVS/lib
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/MVS/lib/aarch64
export PYTHONPATH=$PYTHONPATH:/opt/MVS/Samples/aarch64/Python/MvImport
```

## ğŸ“‹ å¯ç”¨è„šæœ¬å’Œå·¥å…·

### æµ‹è¯•è„šæœ¬
- `quick_test.sh` - å¿«é€Ÿæµ‹è¯•CALLORDERé”™è¯¯
- `test_env.py` - ç¯å¢ƒå˜é‡æµ‹è¯•
- `test_permissions.py` - æƒé™æµ‹è¯•
- `verify_fix.sh` - ç»¼åˆéªŒè¯æµ‹è¯•

### ä¿®å¤è„šæœ¬
- `fix_permissions.sh` - ä¿®å¤USBæƒé™
- `diagnose_camera.sh` - å…¨é¢è¯Šæ–­

### ä½¿ç”¨æ–¹æ³•
```bash
# ç»™æ‰€æœ‰è„šæœ¬æ‰§è¡Œæƒé™
chmod +x *.sh

# è¿è¡Œç›¸åº”è„šæœ¬
sudo ./è„šæœ¬åç§°.sh
```

## ğŸ“– ç¨‹åºåŠŸèƒ½

### å‘½ä»¤è¡Œå‚æ•°
```bash
python3 hikvision_camera_controller_linux.py [OPTIONS]

é€‰é¡¹:
  --calibration PATH    æ ¡å‡†æ–‡ä»¶è·¯å¾„
  --output-dir PATH     è¾“å‡ºç›®å½•ï¼ˆé»˜è®¤: ./capturesï¼‰
  --preview            å¯ç”¨é¢„è§ˆï¼ˆéœ€è¦æ˜¾ç¤ºå™¨ï¼‰
  --list-devices       åˆ—å‡ºå¯ç”¨è®¾å¤‡
  --help               æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

### ä¸»è¦åŠŸèƒ½
1. **ç›¸æœºå‘ç°å’Œè¿æ¥**
2. **å‚æ•°è®¾ç½®**ï¼ˆæ›å…‰ã€å¢ç›Šã€ç™½å¹³è¡¡ç­‰ï¼‰
3. **å›¾åƒé‡‡é›†**
4. **è§†é¢‘å½•åˆ¶**
5. **æ ¡å‡†å‚æ•°åº”ç”¨**
6. **å›¾åƒå»ç•¸å˜**

## ğŸ¯ æˆåŠŸè¿è¡Œçš„æ ‡å¿—

ç¨‹åºæ­£å¸¸å·¥ä½œæ—¶ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š
```
âœ… ç¯å¢ƒå˜é‡æ£€æŸ¥é€šè¿‡
âœ… ç›¸æœºSDKå®ä¾‹åˆ›å»ºæˆåŠŸ
âœ… å‘ç° 1 ä¸ªè®¾å¤‡
âœ… è®¾å¤‡å¥æŸ„åˆ›å»ºæˆåŠŸ
âœ… è®¾å¤‡è¿æ¥æˆåŠŸ
âœ… æ ¡å‡†å‚æ•°åŠ è½½æˆåŠŸ
ç›¸æœºæ§åˆ¶ç¨‹åºå·²å¯åŠ¨ï¼ŒæŒ‰ 'q' é€€å‡º...
```

## ğŸ†˜ å¦‚æœæ‰€æœ‰æ–¹æ³•éƒ½æ— æ•ˆ

1. **é‡æ–°å®‰è£…SDK**
   ```bash
   sudo rm -rf /opt/MVS
   # ä¸‹è½½æœ€æ–°çš„aarch64ç‰ˆæœ¬SDKé‡æ–°å®‰è£…
   ```

2. **æ£€æŸ¥ç¡¬ä»¶**
   - å°è¯•ä¸åŒçš„USBç«¯å£
   - ä½¿ç”¨ä¸åŒçš„USBçº¿
   - åœ¨å…¶ä»–è®¾å¤‡ä¸Šæµ‹è¯•ç›¸æœº

3. **è”ç³»æŠ€æœ¯æ”¯æŒ**
   - æ”¶é›†é”™è¯¯æ—¥å¿—ï¼š
     ```bash
     sudo python3 hikvision_camera_controller_linux.py --calibration ../calibration/20250910_232046/calibration_result.json 2>&1 | tee error.log
     ```
   - æä¾›ç³»ç»Ÿä¿¡æ¯ï¼š
     ```bash
     uname -a > system_info.txt
     lsusb >> system_info.txt
     env | grep -E "(MVS|MVCAM|LD_LIBRARY|PYTHONPATH)" >> system_info.txt
     ```

## ğŸ“Š é¡¹ç›®ç»“æ„

```
linux/
â”œâ”€â”€ hikvision_camera_controller_linux.py  # ä¸»ç¨‹åº
â”œâ”€â”€ test_env.py                          # ç¯å¢ƒæµ‹è¯•
â”œâ”€â”€ test_permissions.py                  # æƒé™æµ‹è¯•
â”œâ”€â”€ fix_permissions.sh                   # æƒé™ä¿®å¤
â”œâ”€â”€ diagnose_camera.sh                   # é—®é¢˜è¯Šæ–­
â”œâ”€â”€ quick_test.sh                        # å¿«é€Ÿæµ‹è¯•
â”œâ”€â”€ verify_fix.sh                        # éªŒè¯ä¿®å¤
â”œâ”€â”€ CALLORDERé”™è¯¯è§£å†³æ–¹æ¡ˆ.md              # è¯¦ç»†æ•…éšœæ’é™¤
â””â”€â”€ ä½¿ç”¨æŒ‡å—.md                          # æœ¬æ–‡ä»¶
```

è®°ä½ï¼š**å¤§å¤šæ•°é—®é¢˜å¯ä»¥é€šè¿‡é‡æ–°æ’æ‹”USBè®¾å¤‡æˆ–é‡å¯ç³»ç»Ÿè§£å†³ï¼**